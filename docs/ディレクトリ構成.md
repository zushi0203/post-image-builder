# ディレクトリ構成

本プロジェクトのディレクトリ構成は以下の通りです。

```
post-image-builder/                            # プロジェクトルート
├── docs/                                      # プロジェクトドキュメント
│   ├── 要件定義.md                            # プロジェクトの要件・仕様
│   ├── ディレクトリ構成.md                    # 本ファイル
│   ├── コンポーネントのコーディングガイド.md  # 開発規約
│   └── Lintツールについて.md                  # 品質管理ツール設定
├── packages/                                  # モノレポパッケージ
│   ├── application/                           # メインアプリケーション
│   ├── ui/                                    # UIコンポーネント（プレゼンテーション層）
│   └── sandbox/                               # PoCや実験的実装用
├── package.json                               # プロジェクトルート設定（workspaces）
├── tsconfig.json                              # ルート TypeScript設定
├── eslint.config.js                          # ESLint設定
├── stylelint.config.js                       # Stylelint設定
├── prettier.config.js                        # Prettier設定
└── README.md                                  # プロジェクト概要
```

```
post-image-builder/packages/application/       # メインアプリケーション
├── src/                                       # アプリケーションソースコード
│   ├── pages/                                 # ページコンポーネント
│   │   └── MainPage/                          # メインページ
│   │       ├── MainPage.tsx
│   │       ├── MainPage.test.tsx
│   │       ├── MainPage.css
│   │       ├── logics/                        # ページ固有のロジック
│   │       │   ├── useMainPageState.ts
│   │       │   ├── useMainPageState.test.ts
│   │       │   ├── mainPageHelpers.ts
│   │       │   └── mainPageHelpers.test.ts
│   │       ├── defs/                          # ページ固有の型・定数
│   │       │   ├── MainPageTypes.ts
│   │       │   └── mainPageConstants.ts
│   │       └── index.ts
│   ├── store/                                 # 状態管理（Jotai）
│   │   ├── atoms/                             # Jotai atoms定義
│   │   │   ├── imageAtoms.ts                  # 画像関連の状態
│   │   │   ├── layerAtoms.ts                  # レイヤー関連の状態
│   │   │   ├── animationAtoms.ts              # アニメーション関連の状態
│   │   │   ├── uiAtoms.ts                     # UI関連の状態
│   │   │   └── index.ts
│   │   ├── selectors/                         # 派生状態・セレクター
│   │   │   ├── imageSelectors.ts              # 画像関連の派生状態
│   │   │   ├── layerSelectors.ts              # レイヤー関連の派生状態
│   │   │   └── index.ts
│   │   └── providers/                         # Jotaiプロバイダー
│   │       ├── JotaiProvider.tsx              # Jotaiルートプロバイダー
│   │       └── index.ts
│   ├── features/                              # 機能レイヤー（ビジネスロジック統合）
│   │   ├── imageProcessing/                   # 画像処理機能
│   │   │   ├── ImageProcessingFeature.tsx
│   │   │   ├── ImageProcessingFeature.test.tsx
│   │   │   ├── ImageProcessingFeature.css
│   │   │   ├── logics/                        # 機能統合ロジック
│   │   │   │   ├── useImageProcessing.ts
│   │   │   │   ├── useImageProcessing.test.ts
│   │   │   │   ├── imageProcessingOrchestrator.ts
│   │   │   │   └── imageProcessingOrchestrator.test.ts
│   │   │   ├── defs/                          # 機能固有の型・定数
│   │   │   │   ├── ImageProcessingTypes.ts
│   │   │   │   └── imageProcessingConstants.ts
│   │   │   └── index.ts
│   │   └── index.ts                           # 機能のエクスポート
│   ├── providers/                             # コンテキストプロバイダー
│   │   ├── AppProvider.tsx                    # アプリケーション全体のプロバイダー
│   │   ├── AppProvider.test.tsx
│   │   └── index.ts
│   └── index.ts                               # ページのエクスポート
├── App.tsx                                    # ルートアプリケーションコンポーネント
├── package.json                               # アプリケーション依存関係
├── tsconfig.json                              # TypeScript設定
└── vite.config.ts                             # Vite設定
```

```
post-image-builder/packages/ui/                # UIコンポーネント（プレゼンテーション層）
├── package.json                               # アプリケーション依存関係
├── tsconfig.json                              # TypeScript設定
├── vite.config.ts                             # Vite設定
└── src/                                       # UIコンポーネントソースコード
    ├── features/                              # 機能固有UIコンポーネント
    │   ├── ImageUploader/                     # 画像アップロード機能群
    │   │   ├── FileSelector/                  # ファイル選択機能
    │   │   │   ├── FileSelector.tsx
    │   │   │   ├── FileSelector.test.tsx
    │   │   │   ├── FileSelector.css
    │   │   │   └── index.ts
    │   │   ├── UploadManager/                 # アップロード処理機能
    │   │   │   ├── UploadManager.tsx
    │   │   │   ├── UploadManager.test.tsx
    │   │   │   ├── UploadManager.css
    │   │   │   └── index.ts
    │   │   ├── UploadStatus/                  # アップロード状態表示機能
    │   │   │   ├── UploadStatus.tsx
    │   │   │   ├── UploadStatus.test.tsx
    │   │   │   ├── UploadStatus.css
    │   │   │   └── index.ts
    │   │   ├── ImageUploaderLayout/           # レイアウト統合コンポーネント
    │   │   │   ├── ImageUploaderLayout.tsx
    │   │   │   ├── ImageUploaderLayout.test.tsx
    │   │   │   ├── ImageUploaderLayout.css
    │   │   │   └── index.ts
    │   │   └── defs/                          # UI固有の型・定数
    │   │       ├── ImageUploaderTypes.ts
    │   │       └── imageUploaderConstants.ts
    │   ├── ImageComposer/                     # 画像合成機能群
    │   │   ├── CanvasRenderer/                # キャンバス描画機能
    │   │   │   ├── CanvasRenderer.tsx
    │   │   │   ├── CanvasRenderer.test.tsx
    │   │   │   ├── CanvasRenderer.css
    │   │   │   └── index.ts
    │   │   ├── ComposeControls/               # 合成制御機能
    │   │   │   ├── ComposeControls.tsx
    │   │   │   ├── ComposeControls.test.tsx
    │   │   │   ├── ComposeControls.css
    │   │   │   └── index.ts
    │   │   ├── LayerManager/                  # レイヤー管理機能
    │   │   │   ├── LayerList/                 # レイヤー一覧機能
    │   │   │   │   ├── LayerList.tsx
    │   │   │   │   ├── LayerList.test.tsx
    │   │   │   │   ├── LayerList.css
    │   │   │   │   └── index.ts
    │   │   │   ├── LayerControls/             # レイヤー制御機能
    │   │   │   │   ├── LayerControls.tsx
    │   │   │   │   ├── LayerControls.test.tsx
    │   │   │   │   ├── LayerControls.css
    │   │   │   │   └── index.ts
    │   │   │   ├── LayerProperties/           # レイヤープロパティ機能
    │   │   │   │   ├── LayerProperties.tsx
    │   │   │   │   ├── LayerProperties.test.tsx
    │   │   │   │   ├── LayerProperties.css
    │   │   │   │   └── index.ts
    │   │   │   ├── LayerManagerLayout/        # レイアウト統合コンポーネント
    │   │   │   │   ├── LayerManagerLayout.tsx
    │   │   │   │   ├── LayerManagerLayout.test.tsx
    │   │   │   │   ├── LayerManagerLayout.css
    │   │   │   │   └── index.ts
    │   │   │   ├── defs/
    │   │   │   │   ├── LayerManagerTypes.ts
    │   │   │   │   └── layerManagerConstants.ts
    │   │   │   └── index.ts                   # 機能群のエクスポート
    │   │   ├── ImageComposerLayout/           # レイアウト統合コンポーネント
    │   │   │   ├── ImageComposerLayout.tsx
    │   │   │   ├── ImageComposerLayout.test.tsx
    │   │   │   ├── ImageComposerLayout.css
    │   │   │   └── index.ts
    │   │   └── defs/
    │   │       ├── ImageComposerTypes.ts
    │   │       └── imageComposerConstants.ts
    │   ├── ImagePreview/                      # プレビュー機能群
    │   │   ├── PreviewViewer/                 # プレビュー表示機能
    │   │   │   ├── PreviewViewer.tsx
    │   │   │   ├── PreviewViewer.test.tsx
    │   │   │   ├── PreviewViewer.css
    │   │   │   └── index.ts
    │   │   ├── ThumbnailNavigation/           # サムネイル・ナビゲーション機能
    │   │   │   ├── ThumbnailNavigation.tsx
    │   │   │   ├── ThumbnailNavigation.test.tsx
    │   │   │   ├── ThumbnailNavigation.css
    │   │   │   └── index.ts
    │   │   ├── ViewControls/                  # ビュー制御機能（ズーム等）
    │   │   │   ├── ViewControls.tsx
    │   │   │   ├── ViewControls.test.tsx
    │   │   │   ├── ViewControls.css
    │   │   │   └── index.ts
    │   │   ├── ImagePreviewLayout/            # レイアウト統合コンポーネント
    │   │   │   ├── ImagePreviewLayout.tsx
    │   │   │   ├── ImagePreviewLayout.test.tsx
    │   │   │   ├── ImagePreviewLayout.css
    │   │   │   └── index.ts
    │   │   ├── defs/
    │   │   │   ├── ImagePreviewTypes.ts
    │   │   │   └── imagePreviewConstants.ts
    │   │   └── index.ts                       # 機能群のエクスポート
    │   ├── PositionController/                # 位置調整機能群
    │   │   ├── CoordinateInput/               # 座標入力機能
    │   │   │   ├── CoordinateInput.tsx
    │   │   │   ├── CoordinateInput.test.tsx
    │   │   │   ├── CoordinateInput.css
    │   │   │   └── index.ts
    │   │   ├── PositionPreview/               # 位置プレビュー機能
    │   │   │   ├── PositionPreview.tsx
    │   │   │   ├── PositionPreview.test.tsx
    │   │   │   ├── PositionPreview.css
    │   │   │   └── index.ts
    │   │   ├── PositionControllerLayout/      # レイアウト統合コンポーネント
    │   │   │   ├── PositionControllerLayout.tsx
    │   │   │   ├── PositionControllerLayout.test.tsx
    │   │   │   ├── PositionControllerLayout.css
    │   │   │   └── index.ts
    │   │   ├── defs/
    │   │   │   ├── PositionControllerTypes.ts
    │   │   │   └── positionControllerConstants.ts
    │   │   └── index.ts                       # 機能群のエクスポート
    │   └── parts/                             # 共通パーツコンポーネント
    │       ├── BlendModeSelector/             # ブレンドモード選択パーツ
    │       │   ├── BlendModeSelector.tsx
    │       │   ├── BlendModeSelector.test.tsx
    │       │   ├── BlendModeSelector.css
    │       │   └── index.ts
    │       ├── FileDropZone/                  # ドロップゾーンパーツ
    │       │   ├── FileDropZone.tsx
    │       │   ├── FileDropZone.test.tsx
    │       │   ├── FileDropZone.css
    │       │   └── index.ts
    │       ├── ProgressIndicator/             # 進捗表示パーツ
    │       │   ├── ProgressIndicator.tsx
    │       │   ├── ProgressIndicator.test.tsx
    │       │   ├── ProgressIndicator.css
    │       │   └── index.ts
    │       ├── LayerItem/                     # レイヤーアイテムパーツ
    │       │   ├── LayerItem.tsx
    │       │   ├── LayerItem.test.tsx
    │       │   ├── LayerItem.css
    │       │   └── index.ts
    │       ├── OpacitySlider/                 # 不透明度スライダーパーツ
    │       │   ├── OpacitySlider.tsx
    │       │   ├── OpacitySlider.test.tsx
    │       │   ├── OpacitySlider.css
    │       │   └── index.ts
    │       ├── LayerDragHandle/               # レイヤードラッグハンドルパーツ
    │       │   ├── LayerDragHandle.tsx
    │       │   ├── LayerDragHandle.test.tsx
    │       │   ├── LayerDragHandle.css
    │       │   └── index.ts
    │       ├── ThumbnailItem/                 # サムネイルアイテムパーツ
    │       │   ├── ThumbnailItem.tsx
    │       │   ├── ThumbnailItem.test.tsx
    │       │   ├── ThumbnailItem.css
    │       │   └── index.ts
    │       ├── ZoomSlider/                    # ズームスライダーパーツ
    │       │   ├── ZoomSlider.tsx
    │       │   ├── ZoomSlider.test.tsx
    │       │   ├── ZoomSlider.css
    │       │   └── index.ts
    │       ├── AxisInput/                     # 軸入力パーツ
    │       │   ├── AxisInput.tsx
    │       │   ├── AxisInput.test.tsx
    │       │   ├── AxisInput.css
    │       │   └── index.ts
    │       └── PositionGrid/                  # 位置グリッドパーツ
    │          ├── PositionGrid.tsx
    │          ├── PositionGrid.test.tsx
    │          ├── PositionGrid.css
    │          └── index.ts
    ├── primitives/                            # 独自UIコンポーネント（MUIで対応できない機能）
    │   ├── ImageCanvas/                       # 画像表示用キャンバスコンポーネント
    │   │   ├── ImageCanvas.tsx
    │   │   ├── ImageCanvas.test.tsx
    │   │   ├── ImageCanvas.css
    │   │   ├── ImageCanvas.stories.tsx        # Storybook用
    │   │   └── index.ts
    │   ├── FileDropArea/                      # ファイルドロップエリア
    │   │   ├── FileDropArea.tsx
    │   │   ├── FileDropArea.test.tsx
    │   │   ├── FileDropArea.css
    │   │   ├── FileDropArea.stories.tsx       # Storybook用
    │   │   └── index.ts
    │   ├── AnimationPlayer/                   # アニメーション再生コンポーネント
    │   │   ├── AnimationPlayer.tsx
    │   │   ├── AnimationPlayer.test.tsx
    │   │   ├── AnimationPlayer.css
    │   │   ├── AnimationPlayer.stories.tsx    # Storybook用
    │   │   └── index.ts
    │   ├── ColorPicker/                       # カラーピッカー（MUIにない場合）
    │   │   ├── ColorPicker.tsx
    │   │   ├── ColorPicker.test.tsx
    │   │   ├── ColorPicker.css
    │   │   ├── ColorPicker.stories.tsx        # Storybook用
    │   │   └── index.ts
    │   └── LayerPanel/                        # レイヤーパネル表示
    │       ├── LayerPanel.tsx
    │       ├── LayerPanel.test.tsx
    │       ├── LayerPanel.css
    │       ├── LayerPanel.stories.tsx         # Storybook用
    │       └── index.ts
    └── shared/                                # UI共通リソース
        ├── hooks/                             # 共通カスタムフック
        │   ├── useAnimation.ts                # アニメーション処理（共通）
        │   └── useAnimation.test.ts           # 単体テスト
        ├── utils/                             # ユーティリティ関数
        │   ├── imageProcessor.ts              # 画像処理関数
        │   ├── imageProcessor.test.ts         # 単体テスト
        │   ├── animationGenerator.ts          # アニメーション生成
        │   ├── animationGenerator.test.ts     # 単体テスト
        │   ├── fileValidator.ts               # ファイル検証
        │   ├── fileValidator.test.ts          # 単体テスト
        │   ├── downloadHelper.ts              # ダウンロード処理
        │   ├── downloadHelper.test.ts         # 単体テスト
        │   ├── layerProcessor.ts              # レイヤー処理ロジック
        │   └── layerProcessor.test.ts         # 単体テスト
        ├── defs/                              # 共通の型定義・定数
        │   ├── ImageTypes.ts                  # 画像関連の型定義
        │   ├── imageConstants.ts              # 画像関連の定数
        │   ├── AnimationTypes.ts              # アニメーション関連の型定義
        │   ├── animationConstants.ts          # アニメーション関連の定数
        │   ├── ApiTypes.ts                    # API関連の型定義
        │   ├── LayerTypes.ts                  # レイヤー関連の型定義
        │   ├── layerConstants.ts              # レイヤー関連の定数
        │   └── globalConstants.ts             # グローバル定数
        └── styles/                            # グローバルスタイル
            ├── globals.css                    # グローバルCSS
            └── variables.css                  # CSS変数
└── .storybook/                                # Storybook設定
    ├── main.ts                                # Storybook メイン設定
    ├── preview.ts                             # Storybook プレビュー設定
    └── manager.ts                             # Storybook マネージャー設定
```

```
post-image-builder/packages/sandbox/           # PoCや実験的実装用（特定ブランチでの開発）
├── poc-canvas-optimization/                   # キャンバス最適化PoC例
│   ├── README.md                              # PoC概要・実行方法
│   ├── OptimizedCanvas.tsx
│   ├── performance-test.ts
│   └── index.ts
├── poc-webgl-renderer/                        # WebGL描画PoC例
│   ├── README.md
│   ├── WebGLRenderer.tsx
│   ├── shaders/
│   │   ├── vertex.glsl
│   │   └── fragment.glsl
│   └── index.ts
└── README.md                                  # sandbox全体の使用方法
```

## パッケージ構成

### `packages/application/`
メインアプリケーション（Jotai + ビジネスロジック）。

#### `packages/application/src/pages/`
各ページのコンポーネントとページレベルの状態管理。
- ルーティングに対応するページ単位のコンポーネント
- ページ全体の状態管理とライフサイクル制御
- 複数の機能（features）を組み合わせてページを構成

#### `packages/application/src/features/`
ビジネスロジックを統合し、複数のUIコンポーネントを協調させる機能レイヤー。
- UIコンポーネントの組み合わせとオーケストレーション
- ドメイン固有のビジネスルール実装
- データフローの制御と状態管理

#### `packages/application/src/store/`
Jotaiを使った状態管理（appパッケージ専用）。

**atoms/**: 状態のatomic unit
- 画像、レイヤー、アニメーション、UIなど機能別にatom定義
- 各atomは単一責任を持つ小さな状態単位

**selectors/**: 派生状態・計算状態
- 複数のatomから計算される派生状態
- キャッシュされた計算結果の提供

**providers/**: Jotaiプロバイダー設定
- アプリケーション全体のJotai設定
- DevToolsやPersist等の設定

#### `packages/application/src/providers/`
アプリケーション全体で使用するReactコンテキストプロバイダー（Jotai以外）。

### `packages/ui/`
UIコンポーネントライブラリ（Storybook + プレゼンテーション層 + 共通リソース）。

#### `packages/ui/src/features/`
機能固有のUIコンポーネント（プレゼンテーション専用）。

**特徴:**
- 完全にプレゼンテーション専用（ビジネスロジックなし）
- プロパティによる外部制御
- packages/application/から利用される
- Storybookでの独立開発・テストが可能

#### `packages/ui/src/primitives/`
独自UIコンポーネント（MUIで対応できない機能のみ）。

**特徴:**
- **基本的にはMUIのコンポーネントを優先使用**
- MUIで対応できない独自機能のみを実装
  - 画像キャンバス表示（ImageCanvas）
  - ファイルドロップエリア（FileDropArea）
  - アニメーション再生（AnimationPlayer）
  - レイヤーパネル表示（LayerPanel）
  - MUIにないUI要素（ColorPicker等）
- 完全にビジネスロジックを持たない
- プロパティによる外部制御
- 汎用性とアクセシビリティを重視
- Storybookでの単体開発・テストが可能

#### `packages/ui/.storybook/`
Storybook設定（UIライブラリ専用）。
- UIコンポーネントの独立した開発・テスト環境
- ビジネスロジックに依存しないコンポーネント確認
- デザインシステムの確立


## アーキテクチャの流れ

```
main.tsx → application/App.tsx → application/pages/ → application/features/ → ui/features/ + ui/primitives/
```

1. **main.tsx**: エントリーポイント
2. **application/App.tsx**: ルートコンポーネント・プロバイダー設定
3. **application/pages/**: ページレベルのコンポーネント
4. **application/features/**: ビジネスロジック統合層
5. **ui/features/**: 機能UIコンポーネント（プレゼンテーション）
6. **ui/primitives/**: 独自UIコンポーネント（MUIで対応できない機能）
7. **MUIコンポーネント**: 基本的なUI要素（Button, Input, Dialog等）

#### `packages/ui/src/shared/`
UI配下で共有される共通リソース。

**hooks/**: 複数コンポーネントで共有される汎用的なカスタムフック
- `hookName.ts` - 共通フック本体
- `hookName.test.ts` - 単体テスト

**utils/**: 画像処理、アニメーション生成など、純粋関数として実装可能な処理
- `utilityName.ts` - ユーティリティ関数
- `utilityName.test.ts` - 単体テスト

**defs/**: 複数コンポーネントで共有される型定義・定数
- `TypeName.ts` - 型定義ファイル（アッパーキャメルケース）
- `constantName.ts` - 定数ファイル（ローワーキャメルケース）

**styles/**: UI全体で使用されるグローバルスタイル

### `src/sandbox/`
PoCや実験的実装を行うための専用領域。

**用途:**
- 新機能の技術検証・プロトタイプ開発
- パフォーマンス最適化の実験
- 新しいライブラリ・技術の評価
- アルゴリズムの比較検討

**特徴:**
- **特定のfeatureブランチでの開発専用**
- 本体のコードに影響を与えない独立した実装
- 各PoCフォルダには`README.md`で概要・実行方法を記載
- 検証完了後は本体への統合またはクリーンアップ

**管理方針:**
- PoCごとに個別フォルダを作成
- ブランチマージ時に不要になったPoCは削除
- 有用な検証結果は`docs/`に成果物として残す

## ファイル命名規則

### 型定義ファイル
- **アッパーキャメルケース**を使用
- 例：`ImageTypes.ts`, `AnimationTypes.ts`, `UserTypes.ts`

### 定数ファイル
- **ローワーキャメルケース**を使用
- 例：`imageConstants.ts`, `animationConstants.ts`, `globalConstants.ts`

### `tests/`
E2Eテスト専用ディレクトリ。単体テストは各ファイルに隣接して配置し、保守性とテスト対象の関連性を向上。

## テスト方針

### 単体テスト
- テストファイルは対象ファイルと同じディレクトリに配置
- ファイル名は `*.test.ts` または `*.test.tsx` の命名規則
- Vitest + React Testing Libraryを使用

### E2Eテスト
- `tests/e2e/` ディレクトリに集約
- Playwrightを使用してブラウザ操作をテスト
- 機能ごとにテストファイルを分割