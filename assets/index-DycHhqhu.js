var w={},M={},b={};Object.defineProperty(b,"__esModule",{value:!0});b.loop=b.conditional=b.parse=void 0;var D=function s(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:t;if(Array.isArray(e))e.forEach(function(u){return s(r,u,t,a)});else if(typeof e=="function")e(r,t,a,s);else{var n=Object.keys(e)[0];Array.isArray(e[n])?(a[n]={},s(r,e[n],t,a[n])):a[n]=e[n](r,t,a,s)}return t};b.parse=D;var $=function(r,e){return function(t,a,n,u){e(t,a,n)&&u(t,r,a,n)}};b.conditional=$;var E=function(r,e){return function(t,a,n,u){for(var i=[],c=t.pos;e(t,a,n);){var v={};if(u(t,r,a,v),t.pos===c)break;c=t.pos,i.push(v)}return i}};b.loop=E;var f={};Object.defineProperty(f,"__esModule",{value:!0});f.readBits=f.readArray=f.readUnsigned=f.readString=f.peekBytes=f.readBytes=f.peekByte=f.readByte=f.buildStream=void 0;var R=function(r){return{data:r,pos:0}};f.buildStream=R;var j=function(){return function(r){return r.data[r.pos++]}};f.readByte=j;var q=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+r]}};f.peekByte=q;var U=function(r){return function(e){return e.data.subarray(e.pos,e.pos+=r)}};f.readBytes=U;var K=function(r){return function(e){return e.data.subarray(e.pos,e.pos+r)}};f.peekBytes=K;var X=function(r){return function(e){return Array.from(U(r)(e)).map(function(t){return String.fromCharCode(t)}).join("")}};f.readString=X;var Z=function(r){return function(e){var t=U(2)(e);return r?(t[1]<<8)+t[0]:(t[0]<<8)+t[1]}};f.readUnsigned=Z;var H=function(r,e){return function(t,a,n){for(var u=typeof e=="function"?e(t,a,n):e,i=U(r),c=new Array(u),v=0;v<u;v++)c[v]=i(t);return c}};f.readArray=H;var J=function(r,e,t){for(var a=0,n=0;n<t;n++)a+=r[e+n]&&Math.pow(2,t-n-1);return a},L=function(r){return function(e){for(var t=j()(e),a=new Array(8),n=0;n<8;n++)a[7-n]=!!(t&1<<n);return Object.keys(r).reduce(function(u,i){var c=r[i];return c.length?u[i]=J(a,c.index,c.length):u[i]=a[c.index],u},{})}};f.readBits=L;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r=b,e=f,t={blocks:function(o){for(var p=0,d=[],y=o.data.length,m=0,x=(0,e.readByte)()(o);x!==p&&x;x=(0,e.readByte)()(o)){if(o.pos+x>=y){var A=y-o.pos;d.push((0,e.readBytes)(A)(o)),m+=A;break}d.push((0,e.readBytes)(x)(o)),m+=x}for(var _=new Uint8Array(m),S=0,B=0;B<d.length;B++)_.set(d[B],S),S+=d[B].length;return _}},a=(0,r.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var o=(0,e.peekBytes)(2)(l);return o[0]===33&&o[1]===249}),n=(0,r.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,e.readArray)(3,function(l,o,p){return Math.pow(2,p.descriptor.lct.size+1)})},function(l,o,p){return p.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},t]}]},function(l){return(0,e.peekByte)()(l)===44}),u=(0,r.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(o,p,d){return(0,e.readBytes)(d.text.blockSize)(o)}},t]},function(l){var o=(0,e.peekBytes)(2)(l);return o[0]===33&&o[1]===1}),i=(0,r.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(o,p,d){return(0,e.readString)(d.blockSize)(o)}},t]},function(l){var o=(0,e.peekBytes)(2)(l);return o[0]===33&&o[1]===255}),c=(0,r.conditional)({comment:[{codes:(0,e.readBytes)(2)},t]},function(l){var o=(0,e.peekBytes)(2)(l);return o[0]===33&&o[1]===254}),v=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,r.conditional)({gct:(0,e.readArray)(3,function(l,o){return Math.pow(2,o.lsd.gct.size+1)})},function(l,o){return o.lsd.gct.exists}),{frames:(0,r.loop)([a,i,c,n,u],function(l){var o=(0,e.peekByte)()(l);return o===33||o===44})}],g=v;s.default=g})(M);var I={};Object.defineProperty(I,"__esModule",{value:!0});I.deinterlace=void 0;var N=function(r,e){for(var t=new Array(r.length),a=r.length/e,n=function(o,p){var d=r.slice(p*e,(p+1)*e);t.splice.apply(t,[o*e,e].concat(d))},u=[0,4,2,1],i=[8,8,4,2],c=0,v=0;v<4;v++)for(var g=u[v];g<a;g+=i[v])n(g,c),c++;return t};I.deinterlace=N;var C={};Object.defineProperty(C,"__esModule",{value:!0});C.lzw=void 0;var Q=function(r,e,t){var a=4096,n=-1,u=t,i,c,v,g,l,o,p,z,d,y,B,m,k,h,F,P,x=new Array(t),A=new Array(a),_=new Array(a),S=new Array(a+1);for(m=r,c=1<<m,l=c+1,i=c+2,p=n,g=m+1,v=(1<<g)-1,d=0;d<c;d++)A[d]=0,_[d]=d;var B,z,k,h,P,F;for(B=z=k=h=P=F=0,y=0;y<u;){if(h===0){if(z<g){B+=e[F]<<z,z+=8,F++;continue}if(d=B&v,B>>=g,z-=g,d>i||d==l)break;if(d==c){g=m+1,v=(1<<g)-1,i=c+2,p=n;continue}if(p==n){S[h++]=_[d],p=d,k=d;continue}for(o=d,d==i&&(S[h++]=k,d=p);d>c;)S[h++]=_[d],d=A[d];k=_[d]&255,S[h++]=k,i<a&&(A[i]=p,_[i]=k,i++,!(i&v)&&i<a&&(g++,v+=i)),p=o}h--,x[P++]=S[h],y++}for(y=P;y<u;y++)x[y]=0;return x};C.lzw=Q;Object.defineProperty(w,"__esModule",{value:!0});var O=w.decompressFrames=w.decompressFrame=T=w.parseGIF=void 0,V=te(M),W=b,Y=f,ee=I,re=C;function te(s){return s&&s.__esModule?s:{default:s}}var ae=function(r){var e=new Uint8Array(r);return(0,W.parse)((0,Y.buildStream)(e),V.default)},T=w.parseGIF=ae,ne=function(r){for(var e=r.pixels.length,t=new Uint8ClampedArray(e*4),a=0;a<e;a++){var n=a*4,u=r.pixels[a],i=r.colorTable[u]||[0,0,0];t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2],t[n+3]=u!==r.transparentIndex?255:0}return t},G=function(r,e,t){if(!r.image){console.warn("gif frame does not have associated image.");return}var a=r.image,n=a.descriptor.width*a.descriptor.height,u=(0,re.lzw)(a.data.minCodeSize,a.data.blocks,n);a.descriptor.lct.interlaced&&(u=(0,ee.deinterlace)(u,a.descriptor.width));var i={pixels:u,dims:{top:r.image.descriptor.top,left:r.image.descriptor.left,width:r.image.descriptor.width,height:r.image.descriptor.height}};return a.descriptor.lct&&a.descriptor.lct.exists?i.colorTable=a.lct:i.colorTable=e,r.gce&&(i.delay=(r.gce.delay||10)*10,i.disposalType=r.gce.extras.disposal,r.gce.extras.transparentColorGiven&&(i.transparentIndex=r.gce.transparentColorIndex)),t&&(i.patch=ne(i)),i};w.decompressFrame=G;var ie=function(r,e){return r.frames.filter(function(t){return t.image}).map(function(t){return G(t,r.gct,e)})};O=w.decompressFrames=ie;const oe=Object.freeze(Object.defineProperty({__proto__:null,get decompressFrames(){return O},default:w,get parseGIF(){return T}},Symbol.toStringTag,{value:"Module"}));export{oe as i};
